<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style type="text/css">
		#myCanvas{
		  position: absolute;
		  left: 0px;
		  top: 0px;
		}
	</style>
</head>
<body>
	<canvas id="myCanvas">
Your browser does not support the HTML5 canvas tag.
</canvas>
</body>
<script type="text/javascript">

	var canvas = document.getElementById("myCanvas");
	var content = canvas.getContext("2d");
	
	// 1.将窗口大小赋值给canvas
	var W = window.innerWidth, H = window.innerHeight;
	canvas.width = W;
	canvas.height = H;
	
	// 2.保存五十个圆的对象  方便改变每个圆的样式
	var particles = [];
	var mouseX=W/2;
	var mouseY=H/2;
	
	// 实例化五十个圆对象
	var particle_count = 50;
	for(var i = 0; i < particle_count; i++)
	{
		particles.push(new Particle());
	}
	
	//3.给canvas添加鼠标事件,获取到鼠标的坐标值给圆心
	canvas.addEventListener('mousemove', function(e){
		var e=e||window.event;
		mouseX= e.pageX;
		mouseY= e.pageY;
	}, false);
	
	
	// 圆的样式 类
	function Particle()
	{
		//speed, life, location, life, colors
		//speed.x range = -2.5 to 2.5 
		//speed.y range = -15 to -5 to 改变圆的Y值
		// y值的速度一直为负  但是X值有正负，这样就有往两边走的效果

		this.speedX=-2.5+Math.random()*5;
		this.speedY=-15+Math.random()*10;

		//圆心
		this.x=mouseX;
		this.y=mouseY;


		//圆的半径  10-30
		this.radius = 10+Math.random()*20;
		//life range = 20-30  生命，即走了多少步后消失
		// 总生命长度 
		this.life = 20+Math.random()*10;
		// 剩下的生命
		this.remaining_life = this.life;
		//圆的颜色
		this.r = parseInt(Math.random()*255);
		this.g = parseInt(Math.random()*255);
		this.b = parseInt(Math.random()*255);
	}

	// 画圆 函数
	function draw(){
	
		//画布涂成黑色
		// 图形组合方式 
		//每次开始时设置回原本默认的组合方式
		//
		//每次都画一个跟canvas一样大小的矩形，就能把之前画的圆型给遮掉
		content.globalCompositeOperation = "source-over";
		content.fillStyle = "black";
		content.fillRect(0, 0, W, H);
		content.globalCompositeOperation = "lighter";//组合之后变颜色
		
		// 画圆和循环改变圆的样式
		for(var i = 0; i < particles.length; i++)
		{
			// 图片对象
			var p = particles[i];
			content.beginPath();
			//根据生命改变透明度
			//最后的透明度为.0;
			//20/30=X/1-->x=20/30
			p.opacity = p.remaining_life/p.life;
			//创建渐变对象
			var gradient = content.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.radius);
			// 添加渐变颜色
			// 三个渐变位置
			gradient.addColorStop(0, "rgba("+p.r+", "+p.g+", "+p.b+", "+p.opacity+")");
			gradient.addColorStop(0.5, "rgba("+p.r+", "+p.g+", "+p.b+", "+p.opacity+")");
			gradient.addColorStop(1, "rgba("+p.r+", "+p.g+", "+p.b+", 0)");
			// 设置渐变颜色为渐变
			content.fillStyle = gradient;
			content.arc(p.x, p.y, p.radius, Math.PI*2, false);
			content.fill();
			
			//改变圆的位置和大小和生命
			p.remaining_life--;
			p.radius--;
			p.x += p.speedX;
			p.y += p.speedY;
			
			//再创建圆  当圆的透明度和半径小于时
			if(p.remaining_life < 0 || p.radius < 0)
			{
				//a brand new particle replacing the dead one
				particles[i] = new Particle();
			}
		}
	}
	
	setInterval(draw, 30);

</script>
</html>